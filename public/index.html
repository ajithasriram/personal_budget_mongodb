<!DOCTYPE html>
<html lang="en">
<head>
    <!-- This is an SEO Change -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <!-- This is an SEO Change -->
    <meta name="description" content="A personal-budget management app">
    <!-- This is an SEO Change (changed title content to match meta description content) -->
    <title>Personal-Budget Management App</title>
    <!-- This is an SEO Change -->
    <meta name="robots" content="nofollow">
    <!-- This is an SEO Change -->
    <meta name="theme-color" content="#4d5791">
    <!-- This is an SEO Change -->
    <meta name="msapplication-TileColor" content="#4d5791">
    <!-- This is an SEO Change -->
    <meta name="msapplication-TileImage" content="personal_budget_icon">
    <!-- This is an SEO Change -->
    <link rel="apple-touch-icon" sizes="57x57" href="images/personal_budget_icon.png">
    <!-- This is an SEO Change -->
    <link rel="icon" type="image/png" href="images/personal_budget_icon.png"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">

    <meta charset="utf-8">
</head>
<body>
    <!-- This is an A11y Change -->
    <a class="skip-to-content-link" href="#main">Skip to main content</a>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    
    <div class="menu">
        <!-- This is a Semantic HTML Change -->
        <!-- This is an A11y Change -->
        <nav class="nav" role="navigation">
            <ul>
                <li><a href="">Homepage</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="https://google.com" target="_blank" rel="noopener" rel=noreferrer>Google</a></li>
            </ul>            
        </nav>
    </div>

    <!-- This is an A11y Change -->
    <div class="hero" id="title" role="banner" aria-roledescription="Page title">
            <h1>Personal Budget</h1>
            <h2>A personal-budget management app</h2>
    </div>

    <div class="container">     
        <div class="page-area">
            <!-- This is an A11y Change -->
            <form class="form-inline mr-auto" role="search">
                <!-- This is an A11y Change -->
                <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
                <button type="button" class="btn btn-secondary btn-sm">Search</button>
            </form>
            <div class="center" id="myDoughnutChart" style="height:400px">
                <p>
                    <button class="randomize" >randomize</button>
                </p>                
            </div>
            <main id="main">
            <div class="text-box" role="article">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <h1>Stay on track</h1>
                    <!-- This is an SEO Change -->
                    <div class="center">
                        <img src="images/sharon-mccutcheon--8a5eJ1-mmQ-unsplash.jpg" alt="A person counting cash" width="200px" height="120px" >
                    </div>
                    <p>
                        Do you know where you are spending your money? If you really stop to track it down,
                        you would get surprised! Proper budget management depends on real data... and this
                        app will help you with that!
                    </p>
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <h1>Alerts</h1>
                    <!-- This is an SEO Change -->
                    <div class="center">
                        <img src="images/jamie-street-33oxtOMk6Ac-unsplash.jpg" alt="Mobile notifications" width="200px" height="150px">
                    </div>
                    <p>
                        What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    </p>                    
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <h1>Results</h1>
                    <p>
                        People who stick to a financial plan, budgeting every expense, get out of debt faster!
                        Also, they to live happier lives... since they expend without guilt or fear... 
                        because they know it is all good and accounted for.
                    </p>
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <h1>Chart</h1>
                    <p>
                        <canvas id="myChart" width="300" height="300"></canvas>
                    </p>
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <!-- This is a Semantic HTML Change -->
                    <article>
                        <!-- This is a Semantic HTML Change -->
                        <header>
                            <h1>Why is Budgeting so important?</h1>
                        </header>
                        <p>
                            "Budgeting is simply balancing your expenses with your income. If they don't balance and you spend
                            more than you make, you will have a problem. Many people don't realize that they spend more
                            than they earn and slowly sink deeper into debt every year."
                        </p>
                        <!-- This is an SEO Change -->
                        <a href="https://www.mymoneycoach.ca/budgeting/what-is-a-budget-planning-forecasting" target="_blank" rel="external nofollow" rel="noopener" rel=noreferrer>Read more</a>
                    </article>                   
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <!-- This is a Semantic HTML Change -->
                    <article>
                        <!-- This is a Semantic HTML Change -->
                        <header>
                            <h1>6 Reasons why you need a budget!</h1>
                        </header>
                        <p>
                            <ul class="reasons-for-a-budget">
                                <li>If you're like most folks, you probably aren't following expert financial advice by crafting and following a budget.</li>
                                <li>A budget is simply a spending plan that takes into account both current and future income and expenses.</li>
                                <li>Having a budget keeps your spending in check and makes sure your savings are on track for the future.</li>
                            </ul>                          
                        </p>
                        <!-- This is an SEO Change -->
                        <a href="https://www.investopedia.com/financial-edge/1109/6-reasons-why-you-need-a-budget.aspx" target="_blank" rel="external nofollow" rel="noopener" rel=noreferrer>Read more</a>
                    </article>                  
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <!-- This is a Semantic HTML Change -->
                    <article>
                        <!-- This is a Semantic HTML Change -->
                        <header>
                            <h1>You need a budget!</h1>
                        </header>
                        <p>
                            Read some success stories that were only possible because they had a budget.
                        </p>
                        <!-- This is an SEO Change -->                    
                        <a href="https://www.youneedabudget.com/category/budgeting-success-stories/" target="_blank" rel="external nofollow" rel="noopener" rel=noreferrer>Read more</a>                        
                    </article>
                </section>
            </div>
    
            <div class="text-box">
                <!-- This is a Semantic HTML Change -->
                <section>
                    <!-- This is a Semantic HTML Change -->
                    <article>
                        <!-- This is a Semantic HTML Change -->
                        <header>
                            <h1>They did it! So can you!</h1>
                        </header>
                        <p>
                            Read 4 real life budget success stories. Read more to find out how important it is to maintain a personal budget.
                        </p>
                        <!-- This is an SEO Change -->                    
                        <a href="https://blog.mint.com/goals/they-did-it-and-so-can-you-4-real-life-budget-success-stories-0114/" target="_blank" rel="external nofollow" rel="noopener" rel=noreferrer>Read more</a>
                    </article>
                </section>
            </div>
            </main>
        </div>

    </div>

    <div class="bottom">
        <div class="center">
            <!-- This is a Semantic HTML Change -->
            <footer>All rights reserved &copy; Fabio Nolasco</footer>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>

    <script>
        var dataSource = {
            datasets: [
                {
                    data: [],
                    backgroundColor: []
                }
            ],
            labels: []
        };

        function createChart(){
            var ctx = document.getElementById("myChart").getContext("2d");
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: dataSource
            });
        }

        function getBudget(){
            axios.get('http://localhost:3000/getBudget')
            .then(function(res){
                console.log(res.data.length);
                console.log(res.data[0].budgetValue);
                for(var i = 0; i < res.data.length; i++){
                    dataSource.datasets[0].data[i] = res.data[i].budgetValue;
                    dataSource.labels[i] = res.data[i].title;
                    dataSource.datasets[0].backgroundColor[i] = res.data[i].color;
                }
                createChart();
            });
        }
        getBudget();

        //d3g code:
        var svg = d3.select("#myDoughnutChart")
            .append("svg")
            .append("g")

        svg.append("g")
            .attr("width",100)
            .attr("height",100)
            .attr("viewBox", "0 0 1000 1000")
        svg.append("g")
            .attr("class", "slices");
        svg.append("g")
            .attr("class", "labels");
        svg.append("g")
            .attr("class", "lines");

        var width = 960,
            height = 450,
            margin = 40
            radius = Math.min(width, height) / 2 - margin;

        var pie = d3.layout.pie()
            .sort(null)
            .value(function(d) {
                return d.value;
            });

        var arc = d3.svg.arc()
            .outerRadius(radius * 0.6)
            .innerRadius(radius * 0.3);

        var outerArc = d3.svg.arc()
            .innerRadius(radius * 0.7)
            .outerRadius(radius * 0.7);

        svg.attr("transform", "translate(" + width / 2.5 + "," + height / 2.5 + ")");

        var key = function(d){ return d.data.label; };
        var array =[]
        var range = []
        var backgroundColor = []

        d3.json("http://localhost:3000/getBudget", function(data) {
            console.log(data.length);
            console.log(data[0].title);

            for(var i = 0; i < data.length; i++){
                array[i] = data[i].title;
                range[i] = data[i].budgetValue;
                backgroundColor[i] = data[i].color;
                console.log(array[i]);
            }

            var color = d3.scale.ordinal()
                .domain(array)
                .range(backgroundColor);     

            function randomData (){
                var labels = color.domain();
                return labels.map(function(label){
                    return { label: label, value: Math.random() }
                });
            }

            change(randomData());

            d3.select(".randomize")
                .on("click", function(){
                    change(randomData());
                });


            function change(data) {

                /* ------- PIE SLICES -------*/
                var slice = svg.select(".slices").selectAll("path.slice")
                    .data(pie(data), key);

                slice.enter()
                    .insert("path")
                    .style("fill", function(d) { return color(d.data.label); })
                    .attr("class", "slice");

                slice		
                    .transition().duration(1000)
                    .attrTween("d", function(d) {
                        this._current = this._current || d;
                        var interpolate = d3.interpolate(this._current, d);
                        this._current = interpolate(0);
                        return function(t) {
                            return arc(interpolate(t));
                        };
                    })

                slice.exit()
                    .remove();

                /* ------- TEXT LABELS -------*/

                var text = svg.select(".labels").selectAll("text")
                    .data(pie(data), key);

                text.enter()
                    .append("text")
                    .attr("dy", ".35em")
                    .text(function(d) {
                        return d.data.label;
                    });
                
                function midAngle(d){
                    return d.startAngle + (d.endAngle - d.startAngle)/2;
                }

                text.transition().duration(1000)
                    .attrTween("transform", function(d) {
                        this._current = this._current || d;
                        var interpolate = d3.interpolate(this._current, d);
                        this._current = interpolate(0);
                        return function(t) {
                            var d2 = interpolate(t);
                            var pos = outerArc.centroid(d2);
                            pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                            return "translate("+ pos +")";
                        };
                    })
                    .styleTween("text-anchor", function(d){
                        this._current = this._current || d;
                        var interpolate = d3.interpolate(this._current, d);
                        this._current = interpolate(0);
                        return function(t) {
                            var d2 = interpolate(t);
                            return midAngle(d2) < Math.PI ? "start":"end";
                        };
                    });

                text.exit()
                    .remove();

                /* ------- SLICE TO TEXT POLYLINES -------*/

                var polyline = svg.select(".lines").selectAll("polyline")
                    .data(pie(data), key);
                
                polyline.enter()
                    .append("polyline");

                polyline.transition().duration(1000)
                    .attrTween("points", function(d){
                        this._current = this._current || d;
                        var interpolate = d3.interpolate(this._current, d);
                        this._current = interpolate(0);
                        return function(t) {
                            var d2 = interpolate(t);
                            var pos = outerArc.centroid(d2);
                            pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                            return [arc.centroid(d2), outerArc.centroid(d2), pos];
                        };			
                    });
                
                polyline.exit()
                    .remove();
            }; 
        });      
    </script>
</body>
</html>